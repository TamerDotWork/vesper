
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV File Upload and Preview</title>
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="icon" href="static/favicon.ico" type="image/x-icon">

    <style>
         .upload-card { width: 100%; max-width: 500px; border: none; border-radius: 15px; }
        #loading-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: #0000008c; z-index: 1000; text-align: center; padding-top: 20%; }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="row">
                <div class="col-md-2">
                    <div class="logo"><a href="./"><img src="static/logo.svg" alt=""></a></div>
                </div>
                <div class="col-md-2">
                    <nav class="center-head">
                      
                        <ul>
                            <li><a href="./">Home</a></li>
                            <li><a href="./pricing">Pricing</a></li>
                            <li><a href="./support">Support</a></li>
                            <li><a href="./about">About</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-md-8">
                    <nav class="right-head">
                        <ul>
                
                            <li><a href="./profile">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.12 13.53C12.1 13.53 12.07 13.53 12.05 13.53C12.02 13.53 11.98 13.53 11.95 13.53C9.67998 13.46 7.97998 11.69 7.97998 9.51001C7.97998 7.29001 9.78998 5.48001 12.01 5.48001C14.23 5.48001 16.04 7.29001 16.04 9.51001C16.03 11.7 14.32 13.46 12.15 13.53C12.13 13.53 12.13 13.53 12.12 13.53ZM12 6.97001C10.6 6.97001 9.46998 8.11001 9.46998 9.50001C9.46998 10.87 10.54 11.98 11.9 12.03C11.93 12.02 12.03 12.02 12.13 12.03C13.47 11.96 14.52 10.86 14.53 9.50001C14.53 8.11001 13.4 6.97001 12 6.97001Z" fill="#3A3A3A"/>
<path d="M12 22.75C9.30996 22.75 6.73996 21.75 4.74996 19.93C4.56996 19.77 4.48996 19.53 4.50996 19.3C4.63996 18.11 5.37996 17 6.60996 16.18C9.58996 14.2 14.42 14.2 17.39 16.18C18.62 17.01 19.36 18.11 19.49 19.3C19.52 19.54 19.43 19.77 19.25 19.93C17.26 21.75 14.69 22.75 12 22.75ZM6.07996 19.1C7.73996 20.49 9.82996 21.25 12 21.25C14.17 21.25 16.26 20.49 17.92 19.1C17.74 18.49 17.26 17.9 16.55 17.42C14.09 15.78 9.91996 15.78 7.43996 17.42C6.72996 17.9 6.25996 18.49 6.07996 19.1Z" fill="#3A3A3A"/>
<path d="M12 22.75C6.07 22.75 1.25 17.93 1.25 12C1.25 6.07 6.07 1.25 12 1.25C17.93 1.25 22.75 6.07 22.75 12C22.75 17.93 17.93 22.75 12 22.75ZM12 2.75C6.9 2.75 2.75 6.9 2.75 12C2.75 17.1 6.9 21.25 12 21.25C17.1 21.25 21.25 17.1 21.25 12C21.25 6.9 17.1 2.75 12 2.75Z" fill="#3A3A3A"/>
</svg>
</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>
        
        <main>
            <div class="row">
                
                <div class="col-md-2 sidebar">
                    <strong>Quick Actions</strong>
                    <ul>
                        <li><a href="./">

<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9 17V11L7 13" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M9 11L11 13" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M22 10V15C22 20 20 22 15 22H9C4 22 2 20 2 15V9C2 4 4 2 9 2H14" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M22 10H18C15 10 14 9 14 6V2L22 10Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

Upload</a></li>
                        <li><a href="./explore">

<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 17.5H14" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 17.5V7.5C2 3.5 3 2.5 7 2.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M22 17.5V7.5C22 3.5 21 2.5 17 2.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10 15.9094V19.1994C10 21.1994 9.2 21.9994 7.2 21.9994H4.8C2.8 21.9994 2 21.1994 2 19.1994V15.9094C2 13.9094 2.8 13.1094 4.8 13.1094H7.2C9.2 13.1094 10 13.9094 10 15.9094Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M22 15.9094V19.1994C22 21.1994 21.2 21.9994 19.2 21.9994H16.8C14.8 21.9994 14 21.1994 14 19.1994V15.9094C14 13.9094 14.8 13.1094 16.8 13.1094H19.2C21.2 13.1094 22 13.9094 22 15.9094Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

Explore</a></li>
                        <li><a href="./insights">

<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.89999 17H18.09C19.99 17 20.99 16 20.99 14.1V2H2.98999V14.1C2.99999 16 3.99999 17 5.89999 17Z" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 2H22" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 22L12 20V17" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M16 22L12 20" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M7.5 11L10.65 8.37C10.9 8.16 11.23 8.22 11.4 8.5L12.6 10.5C12.77 10.78 13.1 10.83 13.35 10.63L16.5 8" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
Insights</a></li>
                    </ul>
                    <hr>
                    <ul>
                        <li><a href="./config">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 12.88V11.12C2 10.08 2.85 9.22 3.9 9.22C5.71 9.22 6.45 7.94 5.54 6.37C5.02 5.47 5.33 4.3 6.24 3.78L7.97 2.79C8.76 2.32 9.78 2.6 10.25 3.39L10.36 3.58C11.26 5.15 12.74 5.15 13.65 3.58L13.76 3.39C14.23 2.6 15.25 2.32 16.04 2.79L17.77 3.78C18.68 4.3 18.99 5.47 18.47 6.37C17.56 7.94 18.3 9.22 20.11 9.22C21.15 9.22 22.01 10.07 22.01 11.12V12.88C22.01 13.92 21.16 14.78 20.11 14.78C18.3 14.78 17.56 16.06 18.47 17.63C18.99 18.54 18.68 19.7 17.77 20.22L16.04 21.21C15.25 21.68 14.23 21.4 13.76 20.61L13.65 20.42C12.75 18.85 11.27 18.85 10.36 20.42L10.25 20.61C9.78 21.4 8.76 21.68 7.97 21.21L6.24 20.22C5.33 19.7 5.02 18.53 5.54 17.63C6.45 16.06 5.71 14.78 3.9 14.78C2.85 14.78 2 13.92 2 12.88Z" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
Config</a></li>
                    </ul>
                    <p class="copyrights">© 2025 Iceberg. All rights reserved.</p>
                </div>
                <div class="col-md-10">
                        <!-- <h2>Clear, engaging and interactive</h2> -->
                       <div class="banner">
                     <form id="auto-upload-form" method="POST" enctype="multipart/form-data">
                    <input type="file" id="auto-csv-file" name="file" accept=".csv" style="display: none;">
  
                            <div class="cta">
                                <small>Drag & Drop your file here or click to upload CSV / Excel</small>
                                <h1>Data Wellness & Insights</h1>
                                <p>Upload your raw data and let AI automatically clean missing values, fix formatting issues, standardize columns, and generate insights — instantly and accurately</p>
                                <button id="open-upload-modal" class="btn-primary"  type="button" >

Upload dataset</button>
                            </div>
                              </form>
                            <div class="hero">
                                <img src="static/hero.png" alt="" class="img-responsive">
                            </div>
                            </div>
                    <footer>
                      
                    </footer>

                </div>
            </div>
            
        </main>
        <div id="loading-overlay" style="display:none; ">
            <div id="errorIcon"  ><img id="danger" src="static/danger.svg" alt=""></div>
            <img id="preloader" src="static/preloader.gif" alt="">
            <div id="errorContainer">
                <div id="errorMsg"  ></div>
                <a href="." id="refresh">Try again</a>
            </div>
            
            
        </div>
    </div>

   

    <script src="static/js/jquery-3.6.0.min.js"></script>
    <!-- <script src="static/js/script.js"></script> -->
    <script>
        $(document).ready(function() {
            $('#open-upload-modal').on('click', function() {
                $('#auto-csv-file').click();
            });

            $('#auto-csv-file').on('change', function() {
                $('#auto-upload-form').submit();
            });
        });
 

    $('#auto-upload-form').on('submit', async function(e) {
           e.preventDefault();
           $('main,header').css('filter', 'blur(24px)');

            const fileInput = document.getElementById('auto-csv-file');
            const errorDiv = document.getElementById('errorMsg');
            const errorContainer = document.getElementById('errorContainer');
            const loader = document.getElementById('loading-overlay');
            const errorIcon = document.getElementById('errorIcon');
            const preloaderIcon = document.getElementById('preloader');

            

            loader.style.display = 'block';
            errorDiv.style.display = 'none';
            errorContainer.style.display = 'none';
            errorIcon.style.display = 'none';
            preloaderIcon.style.display = 'block';
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {   
                // FIX: Use 'upload' (relative) instead of '/upload' (absolute)
                const response = await fetch('api', {
                    method: 'POST',
                    body: formData
                });

                // Read text first to catch HTML errors (like 404/500)
                const responseText = await response.text();

                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (err) {
                     
                    console.error("Server HTML Response:", responseText);
                    throw new Error(`Server returned error (${response.status}). See console.`);
                }

                if (!response.ok || result.error) {
                  
                    throw new Error(result.error || "Unknown Server Error");
                }

                //   $('main,header').css('filter', 'none');
                sessionStorage.setItem('dqResult', JSON.stringify(result));
                window.location.href = "explore"; // Relative redirect

            } catch (err) {
                errorIcon.style.display = 'flex';
                loader.style.display = 'block';
                errorDiv.textContent = err.message;
                errorDiv.style.display = 'block';
                errorContainer.style.display = 'block';
                preloaderIcon.style.display = 'none';
            }
    });

 
   
 
    </script>
</body>
</html>